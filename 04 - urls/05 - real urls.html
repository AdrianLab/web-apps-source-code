<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
		<title>Real URLs</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<!-- Styles -->
		<style type="text/css">
			body {
				font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
				font-size: 112.5%;
				max-width: 40em;
				width: 88%;
				margin-left: auto;
				margin-right: auto;
			}
		</style>
	</head>

	<body>

		<h1>Hello, world.</h1>


		<!-- Scripts -->
		<script>
			/**
			 * Parse a URL pathname for variables
			 * @param  {String} pattern The pattern to match
			 * @param  {String} url     The pathname to parse
			 * @return {Object}         Details from the pathname
			 */
			var parsePathname = function (pattern, url) {

				// Variables
				var map = {};
				var keys = [];
				var matches = false;

				// If the URL is an exact match for the pattern, return it
				if (url === pattern || url + '/' === pattern) {
					return {
						id: pattern,
						params: {},
						url: url
					};
				}

				// Add a trailing slash to the URL if one is missing
				url = url.slice(-1) === '/' ? url : url + '/';

				// Push variables in the pattern to our key array and replace them with regex match grouping
				var newPattern = pattern.replace('(*)', '.+?').replace(/\(:.+?\)/g, function(match) {
					var key = match.slice(2, -1);
					keys.push(key);
					return '([^/]*)';
				});

				// Test the URL against the pattern.
				// If it's a match, pull the variables out into the map
				var test = url.replace(new RegExp('^' + newPattern + '/$'), function() {
					matches = true;
					for (var i = 0; i < keys.length; i++) {
						map[keys[i]] = arguments[i+1];
					}
				});

				// Return the data
				return {
					id: (matches ? pattern : null),
					params: map,
					url: url
				};
			};

			console.group('pattern: /settings');
				console.log(parsePathname('/settings', '/settings'));
				console.log(parsePathname('/settings', '/settings/username'));
			console.groupEnd();

			console.group('pattern: /settings/username');
				console.log(parsePathname('/settings/username', '/settings'));
				console.log(parsePathname('/settings/username', '/settings/username'));
			console.groupEnd();

			console.group('pattern: /books/(:author)/(:book)');
				console.log(parsePathname('/books/(:author)/(:book)', '/books/rowling/harry%20potter'));
				console.log(parsePathname('/books/(:author)/(:book)', '/books/adams/hitchhikers'));
				console.log(parsePathname('/books/(:author)/(:book)', '/books/adams/hitchhikers/part-2'));
			console.groupEnd();

			console.group('pattern: /publisher/(*)/(:book)');
				console.log(parsePathname('/publisher/(*)/(:book)', '/publisher/adams/hitchhikers'));
				console.log(parsePathname('/publisher/(*)/(:book)', '/publisher/1979/hitchhikers'));
				console.log(parsePathname('/publisher/(*)/(:book)', '/publisher/1979/adams/hitchhikers'));

				// So you can see a challenge with wildcards
				// This returns the wrong result for (:book)
				console.log(parsePathname('/publisher/(*)/(:book)', '/publisher/1979/hitchhikers/adams'));
			console.groupEnd();
		</script>
	</body>
</html>